<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://static.drip.trade/collections/enelly_pfp.png">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <title>Enelly Staking Legends - HyperEVM</title>
    <style>
        :root {
            --privy-color-accent: #00ffcc;
            --privy-color-success-dark: #00cc99;
            --privy-color-success-light: #66ffe6;
            --privy-color-foreground-accent: #e0e0e0;
            --bg-color: #2dd4bf;
            --sec-color: #f1f1f1;
            --dark-white: #e5e5e5;
            --darker-indigo: #4b0082;
            --text-color: #000000;
        }
        *, ::after, ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb;
        }
        body {
            margin: 0;
            line-height: inherit;
            font-family: 'Orbitron', ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: var(--bg-color);
            color: #e0e0e0;
        }
        .container {
            max-width: 56rem;
            margin-left: auto;
            margin-right: auto;
            background: var(--sec-color);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: filter 0.3s ease;
        }
        .container.loading {
            filter: blur(5px);
        }
        header.fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            padding: 1rem 1rem 0;
        }
        header.fixed .inner {
            max-width: 85rem;
            margin: 0 auto;
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f1f1f1;
            padding: 1rem 1.5rem;
            border-radius: 20px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        nav {
            display: flex;
            background-color: #f1f1f1;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--privy-color-success-dark);
            font-weight: bold;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }
        .logo:hover {
            opacity: 0.7;
        }
        .logo img {
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            border: 2px solid var(--privy-color-success-dark);
        }
        .nav-links {
            display: none;
            background-color: #f1f1f1;
            align-items: center;
            gap: 1.5rem;
        }
        .nav-links a {
            color: var(--privy-color-success-dark);
            font-size: 0.875rem;
            font-weight: 400;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }
        .nav-links a:hover {
            opacity: 0.7;
        }
        .nav-links a[aria-current="page"] {
            font-weight: 700;
        }
        .mobile-menu-btn {
            display: block;
            color: var(--privy-color-success-dark);
            transition: opacity 0.3s ease;
        }
        .mobile-menu-btn:hover {
            opacity: 0.7;
        }
        @media (min-width: 768px) {
            .nav-links {
                display: flex;
            }
            .mobile-menu-btn {
                display: none;
            }
        }
        .mobile-menu {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--privy-color-success-light);
            z-index: 50;
            flex-direction: column;
            padding: 1.5rem;
        }
        .mobile-menu.active {
            display: flex;
        }
        .mobile-menu .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .mobile-menu .links {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .spacer {
            height: 6rem;
        }
        .profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .profile img {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px;
            border: 2px solid var(--privy-color-accent);
        }
        .profile span {
            font-weight: 600;
            color: var(--privy-color-accent);
        }
        .profile small {
            font-size: 0.75rem;
            color: #d1d5db;
        }
        .profile .nft-count {
            font-size: 0.75rem;
            color: var(--privy-color-success-dark);
            margin-left: 0.25rem;
        }
        .buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .submit-glow {
            background: var(--privy-color-accent);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .submit-glow::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }
        .submit-glow:hover:not(:disabled)::after {
            width: 200%;
            height: 200%;
        }
        .submit-glow:disabled {
        display: none; /* Replaces background: #9ca3af and cursor: not-allowed */
        }
        .hidden {
            display: none;
        }
        #status, #history, #leaderboard {
            background: var(--dark-white);
            color: var(--text-color);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.875rem;
            text-align: center; /* Centers text */
            line-height: 1.25rem;
            max-height: 200px;
            overflow-y: auto;
        }
        #status .nft-item, #leaderboard .leader-item {
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 0.5rem;
            margin: 0.25rem 0;
        }
        #status img, #history img, #leaderboard img {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 0.25rem;
        }
        #history a {
            color: var(--privy-color-accent);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        #history a:hover {
            color: var(--privy-color-success-dark);
        }
        #leaderboard .leader-item {
            font-size: 1.25rem;
            width: 100%;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        #leaderboard .leader-item:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.02);
            text-shadow: 0 0 5px var(--privy-color-accent);
        }
        #leaderboard .leader-item span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #leaderboard .leader-item .points {
            font-weight: 700;
            color: var(--privy-color-accent);
        }
        #leaderboard .leader-item .nfts {
            color: #666;
            font-style: italic;
        }
        #points {
            color: var(--privy-color-accent);
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-top: 1rem;
        }
        #timer {
            color: #ffcc00;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 0.5rem;
        }
        .stake-card {
            display: none;
            background: var(--sec-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 1rem 0;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .stake-card.active {
            display: block;
        }
        .stake-card .header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stake-card .header img {
            width: 4rem;
            height: 4rem;
            border-radius: 9999px;
            border: 4px solid white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .stake-card .header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
        }
        .stake-card .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .stake-card .grid div {
            background: white;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 4px -1px rgb(0 0 0 / 0.1);
            text-align: center;
        }
        .stake-card .grid .label {
            color: var(--privy-color-accent);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        .stake-card .grid .value {
            color: var(--text-color);
            font-size: 1.5rem;
            font-weight: 700;
        }
        .stake-card .grid .subtext {
            color: #6b7280;
            font-size: 0.875rem;
        }
        footer {
            text-align: center;
            font-family: Arial, Helvetica, sans-serif;
            margin-top: 3rem;
            padding: 2rem 0;
            color: var(--privy-color-success-light);
        }
        footer .socials {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        footer a {
            color: var(--privy-color-success-light);
        }
        .spinner {
            border: 4px solid var(--privy-color-accent);
            border-top: 4px solid var(--bg-color);
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 50;
            transition: opacity 0.3s ease;
        }
        .modal.active {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background: var(--sec-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            width: 100%;
            max-width: 42rem;
            text-align: center;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content {
            transform: scale(1);
        }
        .modal-content h2 {
            color: var(--privy-color-accent);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .modal-content input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            background: var(--dark-white);
            border: 1px solid var(--privy-color-accent);
            color: var(--text-color);
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        .modal-content .nft-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .modal-content .nft-option {
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            transition: border-color 0.3s ease;
        }
        .modal-content .nft-option:hover {
            border-color: var(--privy-color-success-dark);
        }
        .modal-content .nft-option.selected {
            border-color: var(--privy-color-accent);
        }
        .modal-content .nft-option img {
            width: 100%;
            height: auto;
            border-radius: 0.25rem;
        }
        .modal-content .submit-glow {
            width: 100%;
        }
        .loader-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        .loader-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--privy-color-accent);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        .socials img {
    transition: transform 0.3s ease-in-out;
}

.socials img:hover {
    transform: scale(1.2);
}
/* History Toggle */
.history-toggle {
    background: var(--dark-white);
    color: var(--privy-color-accent);
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    margin-top: 1rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    transition: all 0.3s ease;
}

.history-toggle:hover {
    background: var(--privy-color-accent);
    color: white;
}

.toggle-icon {
    transition: transform 0.3s ease;
}

.history-toggle.active .toggle-icon {
    transform: rotate(180deg);
}

/* Collapsible History */
#history {
    background: var(--dark-white);
    color: var(--text-color);
    padding: 1rem;
    border-radius: 0.5rem;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    line-height: 1.25rem;
    max-height: 200px;
    overflow-y: auto;
    text-align: center;
    transition: max-height 0.3s ease, opacity 0.3s ease;
}

#history.collapsed {
    max-height: 0;
    opacity: 0;
    padding: 0 1rem;
    overflow: hidden;
}

/* Adjust timer margin since points is gone */
#timer {
    color: #ffcc00;
    font-size: 1.2rem;
    text-align: center;
    margin-top: 1rem; /* Increased from 0.5rem */
}
    </style>
</head>
<body>
    <header class="fixed">
        <div class="inner">
            <nav>
                <a href="/" class="logo">
                    <img src="https://static.drip.trade/collections/enelly_pfp.png" alt="Enelly Logo">
                    <span>Enelly</span>
                </a>
                <div class="nav-links">
                    <a href="https://enelly.xyz/">∘ Home</a>
                    <a href="https://enelly.xyz/roadmap">∘ Roadmap</a>
                    <a href="https://enelly.xyz/vippass">∘ VIP Pass</a>
                    <a href="/stake" aria-current="page">• Stake</a>
                    <a href="https://enelly.xyz/checker">∘ Checker</a>
                    <a href="https://enelly.xyz/rewards">∘ Rewards</a>
                    <a href="https://enelly.xyz/contact">∘ Contact</a>
                    <a href="https://enelly.xyz/faq">∘ FAQ</a>
                </div>
                <button class="mobile-menu-btn" id="mobileMenuButton">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-16 6h16"></path>
                    </svg>
                </button>
            </nav>
        </div>
    </header>

    <div class="mobile-menu" id="mobileMenu">
        <div class="header">
            <a href="/" class="logo">
                <img src="https://static.drip.trade/collections/enelly_pfp.png" alt="Enelly Logo">
                <span>Enelly</span>
            </a>
            <button id="closeMenuButton">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="links">
            <a href="https://enelly.xyz/">∘ Home</a>
            <a href="https://enelly.xyz/roadmap">∘ Roadmap</a>
            <a href="https://enelly.xyz/vippass">∘ VIP Pass</a>
            <a href="/stake" aria-current="page">• Stake</a>
            <a href="https://enelly.xyz/checker">∘ Checker</a>
            <a href="https://enelly.xyz/rewards">∘ Rewards</a>
            <a href="https://enelly.xyz/contact">∘ Contact</a>
            <a href="https://enelly.xyz/faq">∘ FAQ</a>
        </div>
    </div>

    <div class="spacer"></div>

    <div class="container">
    <div class="loader-overlay" id="loaderOverlay">
    <div class="loader"></div>
        </div>    
        <header>
            <h1 style="color: var(--privy-color-success-dark);">Enelly Staking Legends</h1>
            <div class="profile" id="profile">
                <img src="https://static.drip.trade/collections/enelly_pfp.png" id="pfp" alt="PFP">
                <div>
                    <span id="profileName">Unnamed</span><br>
                    <small id="walletAddress">Not Connected</small>
                </div>
            </div>
        </header>
        <div class="container" id="mainContainer">
            <div class="buttons">
                <button class="submit-glow" id="connectWallet">Connect Wallet</button>
                <button class="submit-glow hidden" id="disconnectWallet">Disconnect</button>
                <button class="submit-glow" id="checkRewards">Refresh</button>
                <button class="submit-glow" id="claimRewards" disabled>Claim Rewards</button>
            </div>
        <div class="stake-card" id="stakeCard">
            <div class="header">
                <img src="https://static.drip.trade/collections/enelly_pfp.png" alt="Enelly NFT">
                <h2>Stake Enelly NFT</h2>
            </div>
            <div class="grid">
                <div>
                    <div class="label">Boost</div>
                    <div class="value" id="boostValue">0x</div>
                    <div class="subtext">Up to 20x</div>
                </div>
                <div>
                    <div class="label">Eligible NFTs</div>
                    <div class="value" id="eligibleNFTs">0</div>
                    <div class="subtext">Rewardable NFTs</div>
                </div>
                <div>
                    <div class="label">XP Points</div>
                    <div class="value" id="xpPoints">0</div>
                    <div class="subtext">Total earned</div>
                </div>
            </div>
        </div>
        <div id="status"></div>
        <div id="timer"></div>
        <div class="history-toggle" id="historyToggle">
            <span>Reward History</span>
            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 10l5 5 5-5H7z"/>
            </svg>
        </div>
        <div id="history" class="collapsed">Reward History:<br></div>
        <div id="leaderboard">Leaderboard:<br></div>
    </div>

    <div class="modal" id="profileModal">
        <div class="modal-content">
            <h2>Set Your Profile</h2>
            <input type="text" id="modalName" placeholder="Profile Name" value="Unnamed">
            <div class="nft-grid" id="nftGrid"></div>
            <button class="submit-glow" id="saveProfile">Save</button>
        </div>
    </div>
    </div>
    <footer>
        <div class="socials">
            <a href="https://x.com/EnellyNFT" target="_blank" rel="noopener noreferrer">
                <img src="twitter.png" alt="Twitter" style="width:25px; height:25px;">
            </a>
            <a href="https://discord.gg/EnellyNFT" target="_blank" rel="noopener noreferrer">
                <img src="discord.png" alt="Discord" style="width:25px; height:25px;">
            </a>
            
        </div>
        <p class="text-sm opacity-80">© 2025 Enelly NFT. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const provider = new ethers.providers.JsonRpcProvider("https://rpc.hyperliquid.xyz/evm");
    
            const nftCollections = {
                "0x115b194e5Aa136ce1bFcA6baE021EdbF892B0a51": { name: "Enelly", symbol: "ENL", icon: "https://static.drip.trade/collections/enelly_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/Enelly" },
                "0xED4b30CC6e3345Cc3Ea1065F526235A77b888037": { name: "Enelly VIP Pass", symbol: "ENE", icon: "https://static.drip.trade/collections/enelly-vip-pass_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/enelly-vip-pass" },
                "0x64D98ef4cEfbA64f8353F0cFd88E8370B3486d4b": { name: "Primitive", symbol: "PRMTV", icon: "https://static.drip.trade/collections/primitives_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/Primitive" },
                "0x63eb9d77D083cA10C304E28d5191321977fd0Bfb": { name: "Wealthy Hypio Babies", symbol: "Hypio", icon: "https://static.drip.trade/collections/hypio_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/Wealthy-Hypio-Babies" },
                "0x9Be117D27f8037F6f549903C899e96E5755e96db": { name: "Hypers", symbol: "HYPERS", icon: "https://static.drip.trade/collections/hypers_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/Hypers" },
                "0xCC3D60fF11a268606C6a57bD6Db74b4208f1D30c": { name: "TinyHyperCats", symbol: "THC", icon: "https://static.drip.trade/collections/tiny-hyper-cat_pfp.jpg", tokens: [], dripLink: "https://drip.trade/collections/TinyHyperCats" },
                "0xeA8Cc2a7da4E91c559514B8192eF1cfe1497AC74": { name: "MechaCats", symbol: "MC", icon: "https://static.drip.trade/collections/mechacats_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/MechaCats" },
                "0xDD59aC38cb15F688c18909bA1Ca708A76cC351F5": { name: "Gems", symbol: "GEM", icon: "https://static.drip.trade/collections/gems_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/Gems" },
                "0x44b598C9aCD2AeCC3FC6B285F72e434C93Ab4077": { name: "Hyparrots", symbol: "HYPR", icon: "https://static.drip.trade/collections/hyparrots_pfp.png", tokens: [], dripLink: "https://drip.trade/collections/Hyparrots" }
            };
    
            const nftAbi = [
                "function balanceOf(address owner) view returns (uint256)",
                "function name() view returns (string)",
                "function symbol() view returns (string)",
                "function tokenURI(uint256 tokenId) view returns (string)",
                "function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)"
            ];
            let userAddress = null;
            let totalPoints = 0;
            let lastClaim = null;
            let lastRefresh = null;
            let profileName = "Unnamed";
            let profilePic = "https://static.drip.trade/collections/enelly_pfp.png";
            let rewardHistory = [];
            let leaderboard = {};
            let ownedNfts = [];
            let eligibleNFTs = 0;
            let isLoading = true;
    
            // Mobile menu
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const closeMenuButton = document.getElementById('closeMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
            closeMenuButton.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
    
            // History toggle
            const historyToggle = document.getElementById('historyToggle');
            const historyDiv = document.getElementById('history');
            historyToggle.addEventListener('click', () => {
                historyToggle.classList.toggle('active');
                historyDiv.classList.toggle('collapsed');
            });
    
            async function fetchCollectionData() {
    console.log("Fetching collection data for:", userAddress);
    eligibleNFTs = 0;
    let statusHtml = "";
    for (let [address, data] of Object.entries(nftCollections)) {
        const contract = new ethers.Contract(address, nftAbi, provider);
        try {
            if (!data.name) data.name = await contract.name();
            if (!data.symbol) data.symbol = await contract.symbol();
            const balance = await contract.balanceOf(userAddress);
            console.log(`${data.name} (${address}): ${balance.toNumber()} NFTs`);
            statusHtml += `
                <div class="nft-item">
                    <img src="${data.icon}" alt="${data.symbol}">
                    <span>${data.name} (${data.symbol}): ${balance.toNumber()} NFT(s)</span>
                </div>
            `;
            data.tokens = [];
            eligibleNFTs += balance.toNumber();
                        if (address === "0x44b598C9aCD2AeCC3FC6B285F72e434C93Ab4077" && balance.toNumber() > 0) {
                            try {
                                const tokenId = 466;
                                const tokenUri = await contract.tokenURI(tokenId);
                                console.log(`Fetching tokenURI for ${data.name} #${tokenId}: ${tokenUri}`);
                                const response = await fetch(tokenUri);
                                const metadata = await response.json();
                                const image = metadata.image || "https://via.placeholder.com/30";
                                data.tokens.push({ id: tokenId.toString(), image });
                                console.log(`Added token #${tokenId} with image: ${image}`);
                            } catch (e) {
                                console.error(`Error fetching token #466 for ${data.name}:`, e.message);
                                try {
                                    const tokenId = await contract.tokenOfOwnerByIndex(userAddress, 0);
                                    const tokenUri = await contract.tokenURI(tokenId);
                                    console.log(`Fallback tokenURI for ${data.name} #${tokenId}: ${tokenUri}`);
                                    const response = await fetch(tokenUri);
                                    const metadata = await response.json();
                                    const image = metadata.image || "https://via.placeholder.com/30";
                                    data.tokens.push({ id: tokenId.toString(), image });
                                    console.log(`Added fallback token #${tokenId} with image: ${image}`);
                                } catch (e2) {
                                    console.error(`Fallback fetch failed for ${data.name}:`, e2.message);
                                }
                            }
                        } else {
                            for (let i = 0; i < balance.toNumber(); i++) {
                                try {
                                    const tokenId = await contract.tokenOfOwnerByIndex(userAddress, i);
                                    const tokenUri = await contract.tokenURI(tokenId);
                                    console.log(`Fetching tokenURI for ${data.name} #${tokenId}: ${tokenUri}`);
                                    const response = await fetch(tokenUri);
                                    const metadata = await response.json();
                                    const image = metadata.image || "https://via.placeholder.com/30";
                                    data.tokens.push({ id: tokenId.toString(), image });
                                    console.log(`Added token #${tokenId} with image: ${image}`);
                                } catch (e) {
                                    console.error(`Error fetching token ${i} for ${data.name}:`, e.message);
                                }
                            }
                        }
                    } catch (error) {
            console.error(`Error fetching data for ${address}:`, error.message);
            statusHtml += `Error checking ${data.name}: ${error.message}<br>`;
            if (!data.name) data.name = "Unknown";
            if (!data.symbol) data.symbol = "UNK";
        }
    }
    document.getElementById("status").innerHTML = statusHtml || "No eligible NFTs found.";
}
    
            async function detectWallet() {
                return new Promise((resolve) => {
                    if (typeof window.ethereum !== "undefined") {
                        console.log("MetaMask detected!");
                        resolve(window.ethereum.isMetaMask);
                    } else {
                        document.getElementById("status").innerText = "MetaMask not detected!";
                        console.log("MetaMask not found.");
                        resolve(false);
                    }
                });
            }
    
            async function autoConnectWallet() {
                if (!(await detectWallet())) {
                    hideLoader();
                    return;
                }
                try {
                    showLoader();
                    document.getElementById("checkRewards").disabled = true;
                    document.getElementById("claimRewards").disabled = true;
                    const accounts = await window.ethereum.request({ method: "eth_accounts" });
                    if (accounts.length > 0) {
                        userAddress = accounts[0];
                        console.log("Auto-connected wallet:", userAddress);
                        document.getElementById("walletAddress").innerHTML = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)} <span class="nft-count">(${eligibleNFTs} NFTs)</span>`;
                        document.getElementById("status").innerText = `Connected: ${userAddress}`;
                        document.getElementById("connectWallet").innerText = "Connected";
                        document.getElementById("connectWallet").disabled = true;
                        document.getElementById("connectWallet").classList.add("hidden");
                        document.getElementById("disconnectWallet").classList.remove("hidden");
                        await switchToHyperEVM();
                        await fetchCollectionData();
                        loadUserData();
                        await updateStakeCard();
                        updateLeaderboard();
                        checkButtonStates();
                    }
                } catch (error) {
                    console.error("Auto-connect error:", error);
                    document.getElementById("status").innerText = `Auto-connect failed: ${error.message}`;
                } finally {
                    isLoading = false;
                    hideLoader();
                }
            }
    
            document.getElementById("connectWallet").addEventListener("click", async () => {
                if (!(await detectWallet())) return;
                try {
                    showLoader();
                    console.log("Requesting wallet connection...");
                    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                    userAddress = accounts[0];
                    console.log("Connected wallet:", userAddress);
                    document.getElementById("walletAddress").innerHTML = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)} <span class="nft-count">(${eligibleNFTs} NFTs)</span>`;
                    document.getElementById("status").innerText = `Connected: ${userAddress}`;
                    document.getElementById("connectWallet").innerText = "Connected";
                    document.getElementById("connectWallet").disabled = true;
                    document.getElementById("checkRewards").disabled = false;
                    document.getElementById("claimRewards").disabled = false;
                    await switchToHyperEVM();
                    await fetchCollectionData();
                    loadUserData();
                    await updateStakeCard();
                    showProfileModal();
                    updateLeaderboard();
                } catch (error) {
                    document.getElementById("status").innerText = `Connection failed: ${error.message}`;
                    console.error("Connect error:", error);
                } finally {
                    hideLoader();
                }
            });
    
            document.getElementById("profile").addEventListener("click", async () => {
                await fetchCollectionData();
                showProfileModal();
            });
    
            function showProfileModal() {
                const modal = document.getElementById("profileModal");
                const nameInput = document.getElementById("modalName");
                const nftGrid = document.getElementById("nftGrid");
                nameInput.value = profileName;
                nftGrid.innerHTML = "";
                ownedNfts = [];
                console.log("Populating modal with owned NFTs...");
                for (let [address, { name, tokens }] of Object.entries(nftCollections)) {
                    tokens.forEach(token => {
                        ownedNfts.push({ address, name, ...token });
                        const div = document.createElement("div");
                        div.className = "nft-option";
                        div.innerHTML = `<img src="${token.image}" alt="${name} #${token.id}">`;
                        div.onclick = () => {
                            nftGrid.querySelectorAll(".nft-option").forEach(el => el.classList.remove("selected"));
                            div.classList.add("selected");
                            profilePic = token.image;
                        };
                        if (token.image === profilePic) div.classList.add("selected");
                        nftGrid.appendChild(div);
                        console.log(`Added to grid: ${name} #${token.id}`);
                    });
                }
                if (ownedNfts.length === 0) {
                    nftGrid.innerHTML = `No NFTs found. Debug: Check console for fetch errors or ensure you own NFTs in listed collections.`;
                }
                modal.classList.add("active");
                document.getElementById("saveProfile").onclick = () => {
                    profileName = nameInput.value || "Unnamed";
                    document.getElementById("profileName").innerText = profileName;
                    document.getElementById("pfp").src = profilePic;
                    saveUserData();
                    updateLeaderboard();
                    updateStakeCard();
                    modal.classList.remove("active");
                };
            }
    
            async function switchToHyperEVM() {
                try {
                    console.log("Switching to HyperEVM...");
                    await window.ethereum.request({
                        method: "wallet_switchEthereumChain",
                        params: [{ chainId: "0x3e7" }]
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        console.log("Adding HyperEVM chain...");
                        await window.ethereum.request({
                            method: "wallet_addEthereumChain",
                            params: [{
                                chainId: "0x3e7",
                                chainName: "Hyperliquid EVM",
                                rpcUrls: ["https://rpc.hyperliquid.xyz/evm"],
                                nativeCurrency: { name: "HYPE", symbol: "HYPE", decimals: 18 },
                                blockExplorerUrls: ["https://hyperevm-explorer.vercel.app/"]
                            }]
                        });
                    } else {
                        throw switchError;
                    }
                }
            }
    
            async function checkHoldings() {
                if (!userAddress || isLoading) return;
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                if (lastRefresh && (now - lastRefresh < oneDay)) {
                    updateTimer();
                    return;
                }
                document.getElementById("status").innerHTML = "Please wait... <span class='spinner'></span>";
                let statusHtml = "";
                for (let [address, { name, symbol, icon }] of Object.entries(nftCollections)) {
                    const contract = new ethers.Contract(address, nftAbi, provider);
                    try {
                        const balance = await contract.balanceOf(userAddress);
                        statusHtml += `
                            <div class="nft-item">
                                <img src="${icon}" alt="${symbol}">
                                <span>${name} (${symbol}): ${balance.toNumber()} NFT(s)</span>
                            </div>
                        `;
                    } catch (error) {
                        statusHtml += `Error checking ${name}: ${error.message}<br>`;
                    }
                }
                document.getElementById("status").innerHTML = statusHtml;
                await fetchCollectionData();
                await updateStakeCard();
                lastRefresh = now;
                saveUserData();
                document.getElementById("checkRewards").disabled = true;
                startTimer();
            }
    
            document.getElementById("checkRewards").addEventListener("click", async () => {
                await checkHoldings();
            });
            document.getElementById("disconnectWallet").addEventListener("click", disconnectWallet);
            document.getElementById("claimRewards").addEventListener("click", async () => {
    if (!userAddress || isLoading) return;
    const now = Date.now();
    const oneDay = 24 * 60 * 60 * 1000;
    if (lastClaim && (now - lastClaim < oneDay)) {
        updateTimer();
        return;
    }
    let claimText = "Claiming rewards...\n";
    let pointsEarned = 0;
    let historyEntry = { time: now, rewards: {} };
    let enellyBalance = 0;
    for (let [address, { name, symbol }] of Object.entries(nftCollections)) {
        const contract = new ethers.Contract(address, nftAbi, provider);
        try {
            const balance = await contract.balanceOf(userAddress);
            if (balance > 0) {
                let xpPerNft = 5; // Default 5 XP
                if (address === "0x115b194e5Aa136ce1bFcA6baE021EdbF892B0a51") {
                    xpPerNft = 20; // Enelly OG - 20 XP
                } // Add "Enelly VIP Pass" address here if different, e.g.:
                // else if (address === "VIP_PASS_ADDRESS") xpPerNft = 10;
                const xp = xpPerNft * balance.toNumber();
                pointsEarned += xp;
                claimText += `${name} (${symbol}): ${balance} NFT(s) = +${xp} XP\n`;
                historyEntry.rewards[name] = { count: balance.toNumber(), xp };
                if (address === "0x115b194e5Aa136ce1bFcA6baE021EdbF892B0a51") {
                    enellyBalance = balance.toNumber();
                }
            }
        } catch (error) {
            claimText += `Error checking ${name}: ${error.message}\n`;
        }
    }
    let multiplier = 0;
    if (enellyBalance >= 50) multiplier = 20;
    else if (enellyBalance >= 40) multiplier = 15;
    else if (enellyBalance >= 30) multiplier = 10;
    else if (enellyBalance >= 20) multiplier = 5;
    else if (enellyBalance >= 10) multiplier = 3;
    else if (enellyBalance >= 5) multiplier = 2;
    else if (enellyBalance > 0) multiplier = 1;
    if (multiplier > 0) {
        pointsEarned *= multiplier;
        claimText += `Enelly Boost: ${multiplier}x applied! Total: ${pointsEarned} XP\n`;
    } else {
        claimText += `No Enelly NFTs detected - Boost: 0x\n`;
    }
    if (pointsEarned > 0) {
        totalPoints += pointsEarned;
        lastClaim = now;
        lastRefresh = now;
        rewardHistory.push(historyEntry);
        document.getElementById("status").innerText = claimText;
        saveUserData();
        updateHistory();
        updateLeaderboard();
        await updateStakeCard();
        document.getElementById("claimRewards").disabled = true;
        document.getElementById("checkRewards").disabled = true;
        startTimer();
    } else {
        document.getElementById("status").innerText = "No rewards to claim!";
    }
});
    
            function startTimer() {
                const oneDay = 24 * 60 * 60 * 1000;
                const interval = setInterval(() => {
                    const now = Date.now();
                    const timeLeft = oneDay - (now - (lastClaim || lastRefresh));
                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        document.getElementById("timer").innerText = "Actions available now!";
                        document.getElementById("claimRewards").disabled = false;
                        document.getElementById("checkRewards").disabled = false;
                    } else {
                        const hours = Math.floor(timeLeft / (60 * 60 * 1000));
                        const minutes = Math.floor((timeLeft % (60 * 60 * 1000)) / (60 * 1000));
                        document.getElementById("timer").innerText = `Next action in ${hours}h ${minutes}m`;
                    }
                }, 1000);
            }
    
            function updateTimer() {
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                const timeLeft = oneDay - (now - (lastClaim || lastRefresh));
                const hours = Math.floor(timeLeft / (60 * 60 * 1000));
                const minutes = Math.floor((timeLeft % (60 * 60 * 1000)) / (60 * 1000));
                document.getElementById("timer").innerText = `Next action in ${hours}h ${minutes}m`;
                document.getElementById("status").innerText = "Chill until the timer’s up!";
            }
    
            function updateHistory() {
                let historyText = "";
                rewardHistory.forEach(entry => {
                    const date = new Date(entry.time).toLocaleString();
                    for (let [name, { count, xp }] of Object.entries(entry.rewards)) {
                        const collection = Object.values(nftCollections).find(c => c.name === name);
                        historyText += `
                            <div>
                                ${date}: 
                                <img src="${collection.icon}" alt="${name}">
                                <a href="${collection.dripLink}" target="_blank">${name}</a>: ${count} NFT(s) ---> +${xp} XP
                            </div>
                        `;
                    }
                });
                document.getElementById("history").innerHTML = historyText || "No rewards claimed yet.";
            }
    
            function updateLeaderboard() {
                leaderboard[userAddress] = { name: profileName, points: totalPoints, pfp: profilePic, nfts: eligibleNFTs };
                let leaderboardText = "Leaderboard:<br>";
                Object.entries(leaderboard)
                    .sort(([, a], [, b]) => b.points - a.points)
                    .slice(0, 5)
                    .forEach(([addr, { name, points, pfp, nfts }], i) => {
                        leaderboardText += `
                            <div class="leader-item">
                                <span>
                                    <img src="${pfp}" alt="${name}">
                                    ${i + 1}. ${name}
                                    <span class="nfts">(${nfts} NFTs)</span>
                                </span>
                                <span class="points">${points} XP</span>
                            </div>
                        `;
                    });
                document.getElementById("leaderboard").innerHTML = leaderboardText;
                localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
            }
    
            async function updateStakeCard() {
                const stakeCard = document.getElementById("stakeCard");
                const boostValue = document.getElementById("boostValue");
                const eligibleNFTsElement = document.getElementById("eligibleNFTs");
                const xpPoints = document.getElementById("xpPoints");
                let enellyBalance = 0;
                const enellyAddress = "0x115b194e5Aa136ce1bFcA6baE021EdbF892B0a51";
                try {
                    const contract = new ethers.Contract(enellyAddress, nftAbi, provider);
                    enellyBalance = (await contract.balanceOf(userAddress)).toNumber();
                    console.log(`Enelly balance for ${userAddress}: ${enellyBalance}`);
                } catch (error) {
                    console.error("Error fetching Enelly balance:", error.message);
                }
                let multiplier = 0;
                if (enellyBalance >= 50) multiplier = 20;
                else if (enellyBalance >= 40) multiplier = 15;
                else if (enellyBalance >= 30) multiplier = 10;
                else if (enellyBalance >= 20) multiplier = 5;
                else if (enellyBalance >= 10) multiplier = 3;
                else if (enellyBalance >= 5) multiplier = 2;
                else if (enellyBalance > 0) multiplier = 1;
                boostValue.innerText = `${multiplier}x`;
                eligibleNFTsElement.innerText = eligibleNFTs;
                xpPoints.innerText = totalPoints;
                stakeCard.classList.add("active");
                document.getElementById("walletAddress").innerHTML = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)} <span class="nft-count">(${eligibleNFTs} NFTs)</span>`;
            }
    
            function saveUserData() {
                if (userAddress) {
                    localStorage.setItem(`${userAddress}_points`, totalPoints);
                    localStorage.setItem(`${userAddress}_lastClaim`, lastClaim);
                    localStorage.setItem(`${userAddress}_lastRefresh`, lastRefresh);
                    localStorage.setItem(`${userAddress}_history`, JSON.stringify(rewardHistory));
                    localStorage.setItem(`${userAddress}_name`, profileName);
                    localStorage.setItem(`${userAddress}_pfp`, profilePic);
                }
            }
    
            function loadUserData() {
    if (userAddress) {
        totalPoints = parseInt(localStorage.getItem(`${userAddress}_points`)) || 0;
        lastClaim = parseInt(localStorage.getItem(`${userAddress}_lastClaim`)) || null;
        lastRefresh = parseInt(localStorage.getItem(`${userAddress}_lastRefresh`)) || null;
        rewardHistory = JSON.parse(localStorage.getItem(`${userAddress}_history`)) || [];
        profileName = localStorage.getItem(`${userAddress}_name`) || "Unnamed";
        profilePic = localStorage.getItem(`${userAddress}_pfp`) || "https://static.drip.trade/collections/enelly_pfp.png";
        leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || {};
        document.getElementById("profileName").innerText = profileName;
        document.getElementById("pfp").src = profilePic;
        document.getElementById("walletAddress").innerHTML = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)} <span class="nft-count">(${eligibleNFTs} NFTs)</span>`;
        fetchCollectionData(); // Add this to populate #status on load
        updateHistory();
        updateLeaderboard();
        updateStakeCard();
        if (lastClaim || lastRefresh) startTimer();
    }
}
            function checkButtonStates() {
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                if (lastClaim && (now - lastClaim < oneDay)) {
                    document.getElementById("claimRewards").disabled = true;
                }
                if (lastRefresh && (now - lastRefresh < oneDay)) {
                    document.getElementById("checkRewards").disabled = true;
                }
                if (lastClaim || lastRefresh) startTimer();
            }

            function disconnectWallet() {
    userAddress = null;
    totalPoints = 0;
    lastClaim = null;
    lastRefresh = null;
    rewardHistory = [];
    eligibleNFTs = 0;
    document.getElementById("walletAddress").innerHTML = "Not Connected";
    document.getElementById("status").innerText = "";
    document.getElementById("connectWallet").innerText = "Connected";
    document.getElementById("connectWallet").disabled = true;
    document.getElementById("connectWallet").classList.add("hidden");
    document.getElementById("disconnectWallet").classList.remove("hidden");
    document.getElementById("checkRewards").disabled = true;
    document.getElementById("claimRewards").disabled = true;
    document.getElementById("stakeCard").classList.remove("active");
    document.getElementById("timer").innerText = "";
    updateHistory();
    updateLeaderboard();
    saveUserData();
}
            function showLoader() {
                document.getElementById("loaderOverlay").classList.remove("hidden");
                document.getElementById("mainContainer").classList.add("loading");
            }
    
            function hideLoader() {
                const loader = document.getElementById("loaderOverlay");
                loader.classList.add("hidden");
                document.getElementById("mainContainer").classList.remove("loading");
            }
    
            // Auto-connect on page load
            autoConnectWallet();
        });
    </script>
</body>
</html>